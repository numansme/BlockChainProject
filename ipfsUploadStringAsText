const axios = require('axios');
const fs = require('fs');
const FormData = require('form-data');
require('dotenv').config();

const uploadStringToIPFS = async (data, fileName) => {
  try {
    // Pinata API anahtarı ve API sırrı
    const apiKey = process.env.PINATA_API_KEY;
    const apiSecret = process.env.PINATA_API_SECRET;

    // Veriyi bir dosyaya yazma
    fs.writeFileSync(fileName, data, 'utf-8');

    // FormData objesini oluşturun
    const formData = new FormData();
    formData.append('file', fs.createReadStream(fileName));
    formData.append('pinataOptions', JSON.stringify({ cidVersion: 0 }));
    formData.append('pinataMetadata', JSON.stringify({ name: fileName.split('.')[0] }));

    // Pinata servisine isteği gönderin
    const response = await axios.post('https://api.pinata.cloud/pinning/pinFileToIPFS', formData, {
      headers: {
        'Content-Type': 'multipart/form-data',
        'pinata_api_key': apiKey,
        'pinata_secret_api_key': apiSecret,
      },
    });

    // IPFS hash'ini konsola yazdırın
    console.log('IPFS Hash:', response.data.IpfsHash);
    console.log(`View the file here: https://gateway.pinata.cloud/ipfs/${response.data.IpfsHash}`);
  } catch (error) {
    console.error('IPFS Yükleme Hatası:', error);
  }
};

// Örnek kullanım
const dataToUpload = 'tanrım kötü kulları'; // Kaydedilecek veri
const fileNameToSave = 'test.txt'; // Kaydedilecek dosyanın adı

uploadStringToIPFS(dataToUpload, fileNameToSave);
